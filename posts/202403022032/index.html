<!doctype html><html><head><meta http-equiv=X-UA-Compatible content="ie=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ecrose"><meta name=keywords content="Ecrose,Blog,æŠ€æœ¯"><meta name=description content="Ecroseä¸ªäººåšå®¢ï¼ŒæŠ€æœ¯åˆ†äº«ï¼Œæ•°æ®åº“ï¼ŒDevOps"><meta name=generator content="Hugo 0.124.0"><title>vpsæœåŠ¡å™¨è‡ªåŠ¨å¤‡ä»½å®è·µ ğŸŒŸ Ecrose's Blog</title>
<meta property="og:title" content="vpsæœåŠ¡å™¨è‡ªåŠ¨å¤‡ä»½å®è·µ"><meta property="og:description" content="å›½å†…äº‘å‚å•† ä»¥è…¾è®¯äº‘ä¸ºä¾‹å¯ä»¥ç»“åˆäº‘å‡½æ•°è°ƒç”¨æœåŠ¡å™¨æä¾›å•†çš„å¿«ç…§ api å®ç°å®šæœŸè‡ªåŠ¨å¤‡ä»½ã€‚ å…¶ä»– VPS å‰è€…ä¸ä¸€å®šæ‰€æœ‰å‚å•†éƒ½æœ‰ï¼Œè€Œä¸”ä¸ä¸€å®šå…è´¹ã€‚å…·ä½“ä½¿ç”¨ restic + rclone æ¥"><meta property="og:type" content="article"><meta property="og:url" content="/posts/202403022032/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-02T20:32:54+08:00"><meta property="article:modified_time" content="2024-03-02T20:32:54+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="vpsæœåŠ¡å™¨è‡ªåŠ¨å¤‡ä»½å®è·µ"><meta name=twitter:description content="å›½å†…äº‘å‚å•† ä»¥è…¾è®¯äº‘ä¸ºä¾‹å¯ä»¥ç»“åˆäº‘å‡½æ•°è°ƒç”¨æœåŠ¡å™¨æä¾›å•†çš„å¿«ç…§ api å®ç°å®šæœŸè‡ªåŠ¨å¤‡ä»½ã€‚ å…¶ä»– VPS å‰è€…ä¸ä¸€å®šæ‰€æœ‰å‚å•†éƒ½æœ‰ï¼Œè€Œä¸”ä¸ä¸€å®šå…è´¹ã€‚å…·ä½“ä½¿ç”¨ restic + rclone æ¥"><link rel=stylesheet href=/assets/css/style.min.699f46622e3574a7f9ecca4c5877067845fe89ffcd9c4335df2dff23ddae215e.css integrity="sha256-aZ9GYi41dKf57MpMWHcGeEX+if/NnEM13y3/I92uIV4="><script src=/assets/js/main.min.182da266209851bc7c828aa7377f98f914e1e76c8decdd53a6cbe9bffea92cde.js integrity="sha256-GC2iZiCYUbx8goqnN3+Y+RTh52yN7N1Tpsvpv/6pLN4="></script></head><body><header class="header-container layout-block layout-padding"><div class="header-inner content-padding-large soft-size--large soft-style--box"><div class=header-logo><a href=/><h1>Ecrose's Blog</h1></a></div><nav class=header-nav><div class=header-nav--btn><div class=btn-item></div><div class=btn-item></div><div class=btn-item></div></div><div class=header-nav--list><div><a class="list-item soft-size--small soft-style--hover soft-style--active" href=/ title>ğŸ HOME</a>
<a class="list-item soft-size--small soft-style--hover soft-style--active" href=/posts title>ğŸ“‘POSTS</a>
<a class="list-item soft-size--small soft-style--hover soft-style--active" href=/message title>ğŸ‘€MESSAGE</a>
<a class="list-item soft-size--small soft-style--hover soft-style--active" href=/link title>ğŸ”—LINK</a>
<a class="list-item soft-size--small soft-style--hover soft-style--active" href=https://ecrose.cn/index.xml title>ğŸ–‡ï¸RSS</a></div></div></nav></div></header><main id=content><div class="single-container layout-block"><div class=article-info><div class="article-header layout-padding"><div class="article-cover card-container content-padding-large soft-size--large soft-style--box img"><div class=card-cover><img src=https://cdn.jsdelivr.net/gh/2cracer2/oss@master/uPic/server_backup.jpg alt=https://cdn.jsdelivr.net/gh/2cracer2/oss@master/uPic/server_backup.jpg></div><div class=card-text><h1 class=card-text--title>vpsæœåŠ¡å™¨è‡ªåŠ¨å¤‡ä»½å®è·µ</h1><p class=card-text--row>2024-03-02 20:32</p><ul class=card-text--tag><li><a href=/categories/%E6%9D%82%E6%8A%80%E6%B5%85%E5%B0%9D/>æ‚æŠ€æµ…å°</a></li></ul><ul class=card-text--tag><li><a href=/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/>æ•°æ®å¤‡ä»½</a></li></ul></div></div></div><div class=article-content><div class="markdown-body content-padding-large soft-size--large soft-style--box"><h2 id=å›½å†…äº‘å‚å•†>å›½å†…äº‘å‚å•†</h2><p>ä»¥è…¾è®¯äº‘ä¸ºä¾‹å¯ä»¥ç»“åˆäº‘å‡½æ•°è°ƒç”¨æœåŠ¡å™¨æä¾›å•†çš„å¿«ç…§ api å®ç°å®šæœŸè‡ªåŠ¨å¤‡ä»½ã€‚</p><h2 id=å…¶ä»–-vps>å…¶ä»– VPS</h2><p>å‰è€…ä¸ä¸€å®šæ‰€æœ‰å‚å•†éƒ½æœ‰ï¼Œè€Œä¸”ä¸ä¸€å®šå…è´¹ã€‚å…·ä½“ä½¿ç”¨ <a href=https://restic.readthedocs.io/en/stable/ target=_blank rel=noopener>restic</a> + <a href=https://rclone.org/ target=_blank rel=noopener>rclone</a> æ¥å¤‡ä»½ï¼ˆRclone æ”¯æŒåœ¨ä¸åŒå¯¹è±¡å­˜å‚¨ã€ç½‘ç›˜é—´åŒæ­¥ã€ä¸Šä¼ ã€ä¸‹è½½ï¼Œä¸”æ”¯æŒå¢é‡å¤‡ä»½ï¼›è€Œ Restic æ˜¯æ–‡ä»¶åŠ å¯†ï¼Œå¢é‡å¤‡ä»½å·¥å…·ï¼Œå¹¶ä¸”æ”¯æŒå¿«ç…§ï¼Œå¹¶ä¸”å¤‡ä»½ä¸æ¢å¤ç­–ç•¥éƒ½å¯çµæ´»é…ç½®ï¼‰ã€‚</p><p>å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œåˆ©ç”¨ <code>Rclone</code> è®¿é—®å¹¿æ³›çš„å­˜å‚¨åç«¯å’Œ <code>Restic</code> çš„åŠ å¯†åŠå»é‡å¤‡ä»½åŠŸèƒ½ã€‚</p><h2 id=rclone>Rclone</h2><h3 id=å®‰è£…-rclone>å®‰è£… Rclone</h3><ul><li>Rclone ä¹Ÿå¯ä»¥ä»å¤§å¤šæ•° Linux å‘è¡Œç‰ˆçš„å®˜æ–¹ä»“åº“å®‰è£…ã€‚ä¾‹å¦‚ï¼Œåœ¨åŸºäº Debian çš„ç³»ç»Ÿä¸Šï¼Œä½¿ç”¨ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install rclone
</span></span></code></pre></div><p>å¯¹äº macos</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install rclone
</span></span></code></pre></div><h3 id=é…ç½®-rclone>é…ç½® Rclone</h3><p>Rclone æ”¯æŒå¤šç§äº‘å­˜å‚¨æœåŠ¡ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Amazon S 3, Google Drive, Dropbox, OneDrive ç­‰ã€‚å®ƒèƒ½å¤Ÿå¤„ç†æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶ä¼ è¾“ä»¥åŠæ•°æ®å¤‡ä»½ä»»åŠ¡ã€‚
åŒæ—¶é…ç½®å¥½çš„ Rclone è¿›è¡Œè¿ç§»ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œåªè¦é…ç½®ä¸€æ¬¡åï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šè¿ç§»ï¼Œåªè¦å°†é…ç½®æ–‡ä»¶ <code>rclone.conf</code> è¿›è¡Œå¤åˆ¶è¿ç§»åˆ°é…ç½®æ–‡ä»¶å¤¹ä¸­å°±è¡Œã€‚
é€šè¿‡ <code>rclone config file</code> æŸ¥çœ‹é…ç½®æ–‡ä»¶å¤¹ä½ç½®ã€‚</p><h4 id=rclone-è¿æ¥-onedrive>Rclone è¿æ¥ OneDrive</h4><p>æ›´å¤šå…¶ä»–çš„äº‘å­˜å‚¨ã€äº‘ç›˜æŒ‚è½½è§ <a href=https://rclone.org/docs/ target=_blank rel=noopener>rclone æ–‡æ¡£</a>ã€‚</p><p>ä¸ºäº†åœ¨ä¸åŒæœåŠ¡å™¨é—´è¿ç§»é…ç½®ï¼ŒOneDrive æŒ‚è½½æ–¹å¼æ¨èé€šè¿‡ <code>webdav</code>ï¼Œè€Œä¸æ˜¯ <code>api</code>ã€‚</p><ol><li><strong>å¯åŠ¨ Rclone é…ç½®å‘å¯¼</strong>ï¼š<ul><li>è¾“å…¥ <code>rclone config</code>ã€‚è¿™å°†å¯åŠ¨ Rclone çš„é…ç½®å‘å¯¼ã€‚</li><li>åˆ›å»ºæ–°çš„è¿œç¨‹å­˜å‚¨é…ç½®ï¼Œé€‰æ‹© <code>n</code> æ–°å»ºé…ç½®ã€‚</li></ul></li><li><strong>å‘½åè¿œç¨‹å­˜å‚¨</strong>ï¼š<ul><li>å‘å¯¼æ¥ä¸‹æ¥ä¼šè¯¢é—®ä¸ºè¿™ä¸ªè¿œç¨‹å­˜å‚¨é…ç½®èµ·ä¸€ä¸ªåå­—ä¸º <code>xx_onedrive</code></li></ul></li><li><strong>é€‰æ‹©å­˜å‚¨ç±»å‹</strong>ï¼š<ul><li>å‘å¯¼ä¼šå±•ç¤ºå‡ºæ”¯æŒçš„å­˜å‚¨ç±»å‹åˆ—è¡¨ã€‚å¯¹äºé€šè¿‡ WebDAV æŒ‚è½½ OneDriveï¼Œéœ€è¦æ‰¾åˆ°å¹¶é€‰æ‹© <code>WebDAV</code>ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªåˆ—è¡¨å¯èƒ½ä¼šéš Rclone ç‰ˆæœ¬æ›´æ–°è€Œå˜åŒ–ï¼‰ã€‚</li></ul></li><li><strong>é…ç½® WebDAV å‚æ•°</strong>ï¼š<ul><li><strong>URL</strong>ï¼šæ¥ä¸‹æ¥ï¼Œå‘å¯¼ä¼šè¦æ±‚è¾“å…¥ WebDAV æœåŠ¡å™¨çš„ URLã€‚OneDrive çš„ WebDAV åœ°å€é€šå¸¸å½¢å¼ <code>https://xxxxxxxcn-my.sharepoint.com/personal/YOUR_ONEDRIVE_USERID/Documents</code>ã€‚è¿™é‡Œ <code>YOUR_ONEDRIVE_USERID</code> éœ€è¦æ›¿æ¢æˆä½ çš„ OneDrive ç”¨æˆ· IDã€‚</li><li><code># Choose a number from below, or type in your own value# é€‰æ‹© 3 / Sharepoint</code></li><li>ç„¶åè¾“å…¥ email è´¦å·å’Œå¯†ç </li><li><code>bearer_token</code> é»˜è®¤ç•™ç©º</li></ul></li></ol><p>é…ç½®å®Œæˆåé€šè¿‡ <code>rclone ls xx_onedrive:</code> æŸ¥çœ‹æ˜¯å¦æ­£å¸¸è¿æ¥ã€‚
Rclone åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿å­˜å¯†ç æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ NaCl (Networking and Cryptography library) çš„åŠ å¯†åº“è¿›è¡ŒåŠ å¯†ï¼Œä½†ä»éœ€è¦ä¿ç®¡å¥½ <code>rclone.conf</code> æ–‡ä»¶ã€‚
å¦‚æœä½ çš„ç³»ç»Ÿæ”¯æŒ FUSEï¼Œè¿˜å¯ä»¥å°† OneDrive é€šè¿‡ WebDAV æŒ‚è½½åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone mount xx_onedrive:/ /path/to/mountpoint --daemon
</span></span></code></pre></div><h3 id=ä½¿ç”¨-rclone>ä½¿ç”¨ Rclone</h3><p>è™½ç„¶ Rclone ä¹Ÿæ”¯æŒå¢é‡åŠ å¯†å¤‡ä»½ï¼Œä½†æ˜¯ä¸æ”¯æŒå¿«ç…§å’Œç‰ˆæœ¬ç®¡ç†ã€‚
æ‰€ä»¥éœ€è¦å¢é‡å¤‡ä»½ï¼Œç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶ï¼Œç”¨ Resitc å°±æ¯”è¾ƒåˆé€‚ï¼ŒæŠŠ Rclone ä½œä¸º Resitc çš„åç«¯ï¼›è€Œå¸¸è§„æ–‡ä»¶çš„è¿œç¨‹å¤‡ä»½å½’æ¡£ï¼Œæˆ–è€…å¤šä¸ªäº‘å­˜å‚¨æœåŠ¡ä¹‹é—´è¿ç§»æ•°æ®ï¼Œç›´æ¥ç”¨ Rclone å°±å¾ˆåˆé€‚ã€‚</p><h4 id=å¸¸è§„æ–‡ä»¶çš„è¿œç¨‹å¤‡ä»½å½’æ¡£>å¸¸è§„æ–‡ä»¶çš„è¿œç¨‹å¤‡ä»½å½’æ¡£</h4><p>è¿™é‡Œä»¥ <code>/home/user/data</code> ä¸ºä¾‹ã€‚ä½¿ç”¨ <code>tar</code> å‘½ä»¤æ¥å‹ç¼©è¿™ä¸ªæ–‡ä»¶å¤¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tar -czvf data_backup.tar.gz /home/user/data
</span></span></code></pre></div><p>ä½¿ç”¨ <code>gpg</code> å¯¹å‹ç¼©æ–‡ä»¶è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œè¿™é‡Œå»ºè®®ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•å¦‚ AES 256ã€‚ï¼ˆè™½ç„¶ Rclone ä¹Ÿæ”¯æŒåœ¨è¿œç«¯æŒ‡å®šåˆ›å»ºåŠ å¯†æ–‡ä»¶å¤¹ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gpg --symmetric --cipher-algo AES256 data_backup.tar.gz
</span></span></code></pre></div><p>æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œç³»ç»Ÿä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œç”¨äºåŠ å¯†æ–‡ä»¶ã€‚è¿™ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>data_backup.tar.gz.gpg</code> çš„åŠ å¯†æ–‡ä»¶ã€‚
åœ¨ä¸Šä¼ æ–‡ä»¶ä¹‹å‰ï¼Œç¡®ä¿å·²ç»è®¾ç½®å¥½äº†æŒ‡å‘ OneDrive çš„ Rclone è¿œç¨‹é…ç½®ï¼Œä½¿ç”¨ Rclone åœ¨ OneDrive ä¸Šåˆ›å»ºæŒ‡å®šå­˜æ”¾å¤‡ä»½çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ <code>normal_backup</code> ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone mkdir xx_onedrive:/normal_backup
</span></span></code></pre></div><p>ä¸Šä¼ </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone copy data_backup.tar.gz.gpg xx_onedrive:/normal_backup
</span></span></code></pre></div><h4 id=ä¸åŒçš„äº‘å­˜å‚¨æœåŠ¡ä¹‹é—´è¿ç§»>ä¸åŒçš„äº‘å­˜å‚¨æœåŠ¡ä¹‹é—´è¿ç§»</h4><p>ä½¿ç”¨ Rclone çš„ <code>copy</code> æˆ– <code>sync</code> å‘½ä»¤æ¥è¿ç§»æ•°æ®ã€‚<code>copy</code> å‘½ä»¤ä¼šå°†æºä½ç½®çš„æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®ï¼Œè€Œ <code>sync</code> å‘½ä»¤ä¼šåŒæ­¥æºä½ç½®å’Œç›®æ ‡ä½ç½®çš„å†…å®¹ï¼Œä½¿ç›®æ ‡ä½ç½®çš„å†…å®¹ä¸æºä½ç½®å®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬åˆ é™¤ç›®æ ‡ä½ç½®ä¸Šåœ¨æºä½ç½®ä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚</p><p><strong>ä½¿ç”¨ <code>copy</code> è¿ç§»æ•°æ®</strong>ï¼ˆä¸ä¼šåˆ é™¤ç›®æ ‡ä¸­å¤šä½™çš„æ–‡ä»¶ï¼‰:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone copy onedrive:Photos gdrive:PhotosBackup
</span></span></code></pre></div><p>è¿™ä¸ªå‘½ä»¤ä¼šå°† OneDrive ä¸­ <code>Photos</code> æ–‡ä»¶å¤¹çš„å†…å®¹å¤åˆ¶åˆ° Google Drive ä¸­çš„ <code>PhotosBackup</code> æ–‡ä»¶å¤¹ã€‚å¦‚æœ <code>PhotosBackup</code> æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼ŒRclone ä¼šè‡ªåŠ¨åˆ›å»ºã€‚
<strong>ä½¿ç”¨ <code>sync</code> è¿ç§»æ•°æ®</strong>ï¼ˆä½¿ç›®æ ‡ä¸æºåŒæ­¥ï¼ŒåŒ…æ‹¬åˆ é™¤æ“ä½œï¼‰:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone sync onedrive:Photos gdrive:PhotosBackup
</span></span></code></pre></div><p>è¿™ä¸ªå‘½ä»¤ä¼šåŒæ­¥ OneDrive ä¸­ <code>Photos</code> æ–‡ä»¶å¤¹çš„å†…å®¹åˆ° Google Drive ä¸­çš„ <code>PhotosBackup</code> æ–‡ä»¶å¤¹ï¼Œä½¿ <code>PhotosBackup</code> ä¸­çš„å†…å®¹ä¸ <code>Photos</code> å®Œå…¨ä¸€è‡´ã€‚</p><h4 id=ç®€å•å¯¹äº‘å­˜å‚¨ç®¡ç†>ç®€å•å¯¹äº‘å­˜å‚¨ç®¡ç†</h4><h5 id=å¢åŠ ä¸Šä¼ æ–‡ä»¶åŠè¿‡æ»¤è§„åˆ™ä½¿ç”¨>å¢åŠ ï¼ˆä¸Šä¼ ï¼‰æ–‡ä»¶ï¼ˆåŠè¿‡æ»¤è§„åˆ™ä½¿ç”¨ï¼‰</h5><p>å·²ç»ä»‹ç»äº†çš„å¢åŠ ï¼ˆä¸Šä¼ ï¼‰æ–‡ä»¶ï¼Œå†ä»‹ç»ä¸€äº›è¿‡æ»¤è§„åˆ™ä½¿ç”¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rclone copy / remote:backup --dry-run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --include <span style=color:#e6db74>&#34;/root/**&#34;</span> --include <span style=color:#e6db74>&#34;/home/**&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --exclude <span style=color:#e6db74>&#34;/root/.*&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --exclude <span style=color:#e6db74>&#34;/home/code/**&#34;</span> --exclude <span style=color:#e6db74>&#34;/home/config/test/**&#34;</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼š</p><ul><li><code>copy / remote:backup</code> è¡¨ç¤ºå°†æ ¹ç›®å½•ï¼ˆ<code>/</code>ï¼‰ä¸‹çš„å†…å®¹å¤åˆ¶åˆ°è¿œç¨‹å­˜å‚¨çš„ <code>backup</code> ç›®å½•ã€‚å®é™…ä¸Šä¼ çš„å†…å®¹å°†å—åˆ°ä¸‹é¢å®šä¹‰çš„åŒ…å«å’Œæ’é™¤è§„åˆ™çš„å½±å“ã€‚</li><li><code>--include "/root/**"</code> å’Œ <code>--include "/home/**"</code> è¡¨ç¤ºåŒ…å« <code>/root</code> å’Œ <code>/home</code> ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ã€‚</li><li><code>--exclude "/root/.*"</code> æ’é™¤äº† <code>/root</code> ç›®å½•ä¸‹æ‰€æœ‰ä»¥ç‚¹ï¼ˆ<code>.</code>ï¼‰å¼€å¤´çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚</li><li><code>--exclude "/home/code/**"</code> å’Œ <code>--exclude "/home/config/test/**"</code> åˆ†åˆ«æ’é™¤äº† <code>/home/code</code> å’Œ <code>/home/config/test</code> ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶</li></ul><h5 id=åˆ é™¤æ–‡ä»¶>åˆ é™¤æ–‡ä»¶</h5><p><strong>åˆ é™¤è¿œç¨‹å­˜å‚¨ä¸­çš„å•ä¸ªæ–‡ä»¶ï¼š</strong> ä½¿ç”¨ <code>deletefile</code> å‘½ä»¤åˆ é™¤æŒ‡å®šçš„å•ä¸ªæ–‡ä»¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone deletefile remote:path/to/file -i
</span></span></code></pre></div><p><strong>åˆ é™¤è¿œç¨‹å­˜å‚¨ä¸­çš„æ•´ä¸ªæ–‡ä»¶å¤¹ï¼š</strong> ä½¿ç”¨ <code>purge</code> å‘½ä»¤åˆ é™¤æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å†…å®¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone purge remote:path/to/folder -i
</span></span></code></pre></div><p>ä½¿ç”¨ <code>--dry-run</code> æˆ– <code>-i</code>ï¼ˆäº¤äº’æ¨¡å¼ï¼‰é€‰é¡¹å¯ä»¥é¢„è§ˆå°†è¦æ‰§è¡Œçš„æ“ä½œï¼Œè€Œä¸å®é™…æ‰§è¡Œï¼Œé¿å…è¯¯åˆ é™¤ã€‚</p><h5 id=ä¿®æ”¹æ–‡ä»¶>ä¿®æ”¹æ–‡ä»¶</h5><p><code>rclone</code> å¹¶ä¸ç›´æ¥æ”¯æŒä¿®æ”¹è¿œç¨‹å­˜å‚¨ä¸­çš„æ–‡ä»¶å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œç¼–è¾‘æ–‡ä»¶ï¼‰ã€‚ä¿®æ”¹é€šå¸¸æ¶‰åŠä¸‹è½½æ–‡ä»¶ï¼Œè¿›è¡Œæœ¬åœ°ç¼–è¾‘ï¼Œç„¶åé‡æ–°ä¸Šä¼ è¦†ç›–åŸæ–‡ä»¶ã€‚ä½†æœ‰ç§»åŠ¨æ“ä½œ <code>move</code>, ç§»åŠ¨æ“ä½œä¼šå°†æºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹åˆ é™¤ï¼Œä»…åœ¨ç›®æ ‡ä½ç½®ä¿ç•™å‰¯æœ¬ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone move source:path/to/file_or_folder dest:path/to/dest_folder
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rclone move /path/to/local/file_or_folder remote:path/to/dest <span style=color:#75715e>#ä»æœ¬åœ°ç§»åŠ¨åˆ°è¿œç¨‹å­˜å‚¨</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rclone move remote:path/to/source/file_or_folder remote:path/to/dest <span style=color:#75715e>#åœ¨è¿œç¨‹å­˜å‚¨å†…ç§»åŠ¨</span>
</span></span></code></pre></div><h5 id=æŸ¥çœ‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹>æŸ¥çœ‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</h5><p><strong>åˆ—å‡ºè¿œç¨‹æ–‡ä»¶å¤¹çš„å†…å®¹ï¼š</strong> ä½¿ç”¨ <code>ls</code> å‘½ä»¤åˆ—å‡ºè¿œç¨‹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rclone ls remote:path/to/folder
</span></span></code></pre></div><p><strong>é€’å½’åˆ—å‡ºæ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹çš„å†…å®¹ï¼š</strong> ä½¿ç”¨ <code>lsf</code> å‘½ä»¤ä»¥é€’å½’æ–¹å¼åˆ—å‡ºæ–‡ä»¶å¤¹åŠå…¶æ‰€æœ‰å­æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>-R</code> é€‰é¡¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rclone lsf -R remote:path/to/folder
</span></span></code></pre></div><p><strong>æŸ¥çœ‹æ–‡ä»¶è¯¦æƒ…ï¼š</strong> ä½¿ç”¨ <code>lsd</code> å‘½ä»¤åˆ—å‡ºè¿œç¨‹æ–‡ä»¶å¤¹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rclone lsd remote:path/to/folder
</span></span></code></pre></div><p><strong>å…³é”®è¯æŸ¥è¯¢åªèƒ½ç”¨ç®¡é“ç¬¦ï¼š</strong>
<code>rclone lsf remote:path/to/folder | grep "keyword"</code></p><h3 id=rclone-æ€§èƒ½ä¼˜åŒ–>Rclone æ€§èƒ½ä¼˜åŒ–</h3><h4 id=è°ƒæ•´å¹¶è¡Œä¼ è¾“æ•°---transfers>è°ƒæ•´å¹¶è¡Œä¼ è¾“æ•° <code>--transfers</code></h4><p>Rclone é»˜è®¤åŒæ—¶è¿è¡Œå››ä¸ªæ–‡ä»¶ä¼ è¾“ã€‚åœ¨å¸¦å®½å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¢åŠ  <code>--transfers</code> å‚æ•°çš„å€¼å¯ä»¥æ˜¾è‘—æé«˜ä¼ è¾“é€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¼ è¾“å¤§é‡å°æ–‡ä»¶æ—¶ã€‚ä¾‹å¦‚ï¼Œå°†å¹¶è¡Œä¼ è¾“æ•°å¢åŠ åˆ° 10ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export RCLONE_TRANSFERS<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p>æˆ–è€…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone copy /path/to/source remote:destination --transfers <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><h4 id=è°ƒæ•´æ£€æŸ¥è€…æ•°é‡---checkers>è°ƒæ•´æ£€æŸ¥è€…æ•°é‡ <code>--checkers</code></h4><p>Rclone ä½¿ç”¨æ£€æŸ¥è€…æ¥æ£€æŸ¥æ–‡ä»¶æ˜¯å¦éœ€è¦ä¼ è¾“ã€‚å¢åŠ æ£€æŸ¥è€…çš„æ•°é‡å¯ä»¥åŠ å¿«è¿™ä¸€è¿‡ç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰å¤§é‡æ–‡ä»¶éœ€è¦æ£€æŸ¥æ—¶ã€‚ä¾‹å¦‚ï¼Œå°†æ£€æŸ¥è€…æ•°é‡å¢åŠ åˆ° 20ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rclone sync /path/to/source remote:destination --checkers <span style=color:#ae81ff>20</span>
</span></span></code></pre></div><h2 id=restic>Restic</h2><p>Restic ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li><strong>å»é‡ï¼š</strong> <code>Restic</code> åœ¨å¤‡ä»½æ•°æ®æ—¶é‡‡ç”¨å»é‡æŠ€æœ¯ã€‚å®ƒå°†æ•°æ®åˆ†å‰²æˆå°å—ï¼Œå¹¶å¯¹æ¯å—è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚å¦‚æœæ•°æ®å—çš„å†…å®¹å·²ç»å­˜åœ¨äºå¤‡ä»½ä»“åº“ä¸­ï¼Œåˆ™ä¸ä¼šå†æ¬¡å­˜å‚¨ï¼Œä»è€Œæœ‰æ•ˆå‡å°‘äº†å­˜å‚¨ç©ºé—´çš„éœ€æ±‚ã€‚</li><li><strong>åŠ å¯†ï¼š</strong> <code>Restic</code> é»˜è®¤å¯¹æ‰€æœ‰å¤‡ä»½æ•°æ®è¿›è¡Œç«¯åˆ°ç«¯åŠ å¯†ã€‚å®ƒåœ¨æ•°æ®ç¦»å¼€æœ¬åœ°æœºå™¨ä¹‹å‰å°±è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚</li><li><strong>å¿«ç…§ï¼š</strong> <code>Restic</code> ä»¥å¿«ç…§çš„å½¢å¼å­˜å‚¨å¤‡ä»½ã€‚æ¯æ¬¡å¤‡ä»½éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¿«ç…§ï¼Œä½†ç”±äºå»é‡æŠ€æœ¯çš„ä½¿ç”¨ï¼Œæ¯ä¸ªæ–°å¿«ç…§åªå¢åŠ äº†è‡ªä¸Šæ¬¡å¤‡ä»½ä»¥æ¥å˜åŒ–çš„æ•°æ®é‡ã€‚
å…·ä½“ä»‹ç»è§<a href=https://restic.readthedocs.io/ target=_blank rel=noopener>æ–‡æ¡£</a></li></ul><h3 id=å®‰è£…-restic>å®‰è£… Restic</h3><p>å¤§å¤šæ•° Linux å‘è¡Œç‰ˆéƒ½å¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£… Resticã€‚ä¾‹å¦‚ï¼Œåœ¨åŸºäº Debian çš„ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install restic
</span></span></code></pre></div><p><strong>macOSï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install restic
</span></span></code></pre></div><h3 id=é…ç½®-restic>é…ç½® Restic</h3><p><strong>åˆå§‹åŒ–å¤‡ä»½ä»“åº“ï¼š</strong> é¦–å…ˆï¼Œéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªå¤‡ä»½ä»“åº“ï¼Œè¿™å¯ä»¥æ˜¯æœ¬åœ°ç›®å½•ã€è¿œç¨‹æœåŠ¡å™¨æˆ–ä»»ä½• <code>Restic</code> æ”¯æŒçš„åç«¯å­˜å‚¨ã€‚
åˆå§‹åŒ–éœ€è¾“å…¥ä¸¤æ¬¡å¯†ç ä¾‹å¦‚ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic init --repo /path/to/restic-repo
</span></span></code></pre></div><p><strong>ç»“åˆå·²ç»é…ç½®å¥½çš„ Rclone åˆå§‹åŒ– Restic ä»“åº“ï¼š</strong></p><ul><li>ä½¿ç”¨ rclone ä½œä¸ºåç«¯ï¼Œåˆå§‹åŒ– Restic ä»“åº“ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive/backup init
</span></span></code></pre></div><h3 id=ä½¿ç”¨-restic>ä½¿ç”¨ Restic</h3><h4 id=åˆ›å»ºå¤‡ä»½>åˆ›å»ºå¤‡ä»½</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup backup /path/to/your/data
</span></span></code></pre></div><p>æ—¥å¸¸ä½¿ç”¨æ—¶å¸¸ç»“åˆå¤šä¸ªè¿‡æ»¤éœ€æ±‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup backup /root /home <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --exclude <span style=color:#e6db74>&#39;/root/.*&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --exclude <span style=color:#e6db74>&#39;/home/code&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --exclude <span style=color:#e6db74>&#39;/home/config/test&#39;</span>
</span></span></code></pre></div><p>ä¹Ÿå¯ç”±æ–‡ä»¶è¯»å–å¯¹åº”å‚æ•°ï¼Œè§åé¢çš„è„šæœ¬ç¤ºä¾‹ã€‚</p><p>åŒæ—¶ä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œè¯†åˆ«ä¸åŒçš„å¤‡ä»½ï¼Œå¯åœ¨å¤‡ä»½æ—¶åˆ›å»ºæ·»åŠ æ ‡ç­¾ï¼ˆ<code>--tag</code>ï¼‰æˆ–æŒ‡å®šä¸»æœºåï¼ˆ<code>--host</code>ï¼‰</p><ul><li><strong>ä½¿ç”¨æ ‡ç­¾ï¼š</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup backup /path/to/data --tag mytag
</span></span></code></pre></div><ul><li><strong>ä½¿ç”¨ä¸»æœºåï¼š</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>restic -r rclone:OneDrive:backup backup /path/to/data --host myhost
</span></span></code></pre></div><h4 id=æŸ¥çœ‹å¤‡ä»½>æŸ¥çœ‹å¤‡ä»½</h4><p><strong>è¦åˆ—å‡ºæ‰€æœ‰çš„å¤‡ä»½å¿«ç…§ï¼Œå¯ä»¥ä½¿ç”¨ <code>restic snapshots</code> å‘½ä»¤ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup snapshots
</span></span></code></pre></div><p><strong>æŸ¥çœ‹ç‰¹å®šå¿«ç…§çš„è¯¦ç»†ä¿¡æ¯</strong>
å¯ä»¥æŸ¥çœ‹æŸä¸ªç‰¹å®šå¿«ç…§çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¿«ç…§ä¸­åŒ…å«çš„æ–‡ä»¶å’Œç›®å½•ç»“æ„ã€‚ä½¿ç”¨ <code>restic ls</code> å‘½ä»¤åŠ ä¸Šå¿«ç…§ ID æ¥å®ç°ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup ls &lt;snapshot-id&gt;
</span></span></code></pre></div><h5 id=ä½¿ç”¨æ ‡ç­¾ä¸»æœºåå’Œæ—¶é—´è¿‡æ»¤å¿«ç…§>ä½¿ç”¨æ ‡ç­¾ã€ä¸»æœºåå’Œæ—¶é—´è¿‡æ»¤å¿«ç…§</h5><ul><li><strong>æŒ‰æ ‡ç­¾è¿‡æ»¤</strong>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup snapshots --tag &lt;tag-name&gt;
</span></span></code></pre></div><ul><li><strong>æŒ‰ä¸»æœºåè¿‡æ»¤</strong>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup snapshots --host &lt;host-name&gt;
</span></span></code></pre></div><ul><li><strong>æŒ‰æ—¶é—´è¿‡æ»¤</strong>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>restic -r rclone:OneDrive:backup snapshots --last 24h
</span></span></code></pre></div><ul><li><strong>æŸ¥çœ‹å¿«ç…§ä¹‹é—´çš„å·®å¼‚:</strong></li></ul><p><code>Restic</code> è¿˜æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œå…è®¸æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ä¹‹é—´çš„å·®å¼‚ï¼Œçœ‹çœ‹åœ¨ä¸¤æ¬¡å¤‡ä»½ä¹‹é—´å“ªäº›æ–‡ä»¶è¢«æ”¹å˜ã€æ·»åŠ æˆ–åˆ é™¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>restic -r rclone:OneDrive:backup diff &lt;snapshot-id1&gt; &lt;snapshot-id2&gt;
</span></span></code></pre></div><h5 id=restic-ä»“åº“æŒ‚è½½ä¸ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ>Restic ä»“åº“æŒ‚è½½ä¸ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ</h5><p><code>restic mount</code> å‘½ä»¤å…è®¸å°† Restic ä»“åº“æŒ‚è½½ä¸ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„æ–‡ä»¶æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è®¿é—®å¤‡ä»½æ•°æ®ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ FUSE (Filesystem in Userspace) æŠ€æœ¯å®ç°çš„ï¼Œå®ƒå…è®¸åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r /path/to/repository mount /path/to/mountpoint
</span></span></code></pre></div><h4 id=ç®¡ç†å¤‡ä»½>ç®¡ç†å¤‡ä»½</h4><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¤‡ä»½å¿«ç…§å¯èƒ½ä¼šå ç”¨å¤§é‡å­˜å‚¨ç©ºé—´ã€‚ä½¿ç”¨ <code>restic forget</code> å‘½ä»¤å¯ä»¥åˆ é™¤ä¸å†éœ€è¦çš„æ—§å¿«ç…§ã€‚ç»“åˆ <code>restic prune</code> å‘½ä»¤ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¸…ç†æœªè¢«ä»»ä½•å¿«ç…§å¼•ç”¨çš„æ•°æ®ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚æ³¨æ„ä½¿ç”¨ <code>--dry-run</code> é€‰é¡¹è¿›è¡Œæ¨¡æ‹Ÿæ“ä½œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ é™¤å¿«ç…§åˆ—è¡¨ä¿¡æ¯</span>
</span></span><span style=display:flex><span>$ restic -r rclone:OneDrive:backup snapshots
</span></span><span style=display:flex><span>$ restic -r rclone:OneDrive:backup forget 6eda7c7d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…é™¤æœªå¼•ç”¨çš„æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¿«ç…§ä¸­æ–‡ä»¶å¼•ç”¨çš„æ•°æ®ä»ç„¶å­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­</span>
</span></span><span style=display:flex><span>$ restic -r rclone:OneDrive:backup prune
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>restic -r rclone:OneDrive:backup forget --keep-last <span style=color:#ae81ff>10</span> --keep-daily <span style=color:#ae81ff>7</span> --keep-weekly <span style=color:#ae81ff>4</span> --keep-monthly <span style=color:#ae81ff>6</span> --keep-yearly <span style=color:#ae81ff>3</span> --dry-run
</span></span></code></pre></div><p>è¿™ä¸ªå‘½ä»¤ä¼šæ ¹æ®ä¿ç•™ç­–ç•¥åˆ é™¤ä¸€äº›æ—§å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œä»…ä¿ç•™æœ€è¿‘ 10 ä¸ªå¿«ç…§ã€æ¯å¤©ä¸€ä¸ªå¿«ç…§ä¿ç•™ 7 å¤©ç­‰ã€‚</p><h4 id=æ¢å¤å¿«ç…§>æ¢å¤å¿«ç…§</h4><p>æ¢å¤å¤‡ä»½å¿«ç…§æ˜¯ <code>Restic</code> æœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ã€‚é™¤äº†åŸºæœ¬çš„æ¢å¤æ“ä½œå¤–ï¼Œ<code>Restic</code> è¿˜æä¾›äº†ä¸€äº›é«˜çº§å®ç”¨æ“ä½œï¼Œä½¿å¾—ä»å¤‡ä»½ä¸­æ¢å¤æ•°æ®æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>restic -r rclone:OneDrive:backup snapshots --time <span style=color:#e6db74>&#34;2024-02-25&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åªéœ€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥å°†æœ€æ–°å¿«ç…§çš„å†…å®¹æ¢å¤</span>
</span></span><span style=display:flex><span>$ restic -r rclone:OneDrive:backup <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    restore <span style=color:#ae81ff>79766175</span> --target /tmp/restore-work
</span></span></code></pre></div><h5 id=æ¢å¤ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•>æ¢å¤ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•</h5><p>å¦‚æœåªéœ€è¦ä»å¿«ç…§ä¸­æ¢å¤ç‰¹å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¿«ç…§ï¼Œå¯ä»¥ä½¿ç”¨ <code>--include</code> æˆ– <code>--exclude</code> é€‰é¡¹æ¥æŒ‡å®šæ¢å¤èŒƒå›´ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup restore &lt;snapshot-id&gt; --target /path/to/restore --include <span style=color:#e6db74>&#34;/path/to/file.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>restic -r rclone:OneDrive:backup restore &lt;snapshot-id&gt; --target /path/to/restore --include <span style=color:#e6db74>&#34;/path/to/large_directory/&#34;</span> --exclude <span style=color:#e6db74>&#34;/path/to/large_directory/exclude_this_subdir&#34;</span>
</span></span></code></pre></div><h5 id=æ¢å¤å¤‡ä»½æ—¶çš„å®‰å…¨æ£€æŸ¥>æ¢å¤å¤‡ä»½æ—¶çš„å®‰å…¨æ£€æŸ¥</h5><p>å½“ä½¿ç”¨ <code>restic restore</code> å‘½ä»¤æ¢å¤æ•°æ®æ—¶ï¼Œæ·»åŠ  <code>--verify</code> é€‰é¡¹å°†æŒ‡ç¤º <code>Restic</code> åœ¨æ¢å¤æ¯ä¸ªæ–‡ä»¶åç«‹å³å¯¹å…¶å†…å®¹è¿›è¡Œæ ¡éªŒã€‚è¿™æ„å‘³ç€ <code>Restic</code> ä¼šæ¯”è¾ƒæ–‡ä»¶çš„å†…å®¹å“ˆå¸Œå€¼ä¸ä»“åº“ä¸­è®°å½•çš„å“ˆå¸Œå€¼ï¼Œä»¥ç¡®ä¿å®ƒä»¬å®Œå…¨åŒ¹é…ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r rclone:OneDrive:backup restore &lt;snapshot-id&gt; --target /path/to/restore --verify
</span></span></code></pre></div><h4 id=å¸¸è§å¼‚å¸¸å¤„ç†>å¸¸è§å¼‚å¸¸å¤„ç†</h4><h5 id=é”å®šæœºåˆ¶>é”å®šæœºåˆ¶</h5><p>Restic ä½¿ç”¨é”å®šæœºåˆ¶æ¥ç¡®ä¿å¤‡ä»½ä»“åº“çš„æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚åœ¨è¿›è¡Œå¤‡ä»½ã€æ¢å¤æˆ–ç»´æŠ¤æ“ä½œæ—¶ï¼ŒRestic ä¼šåœ¨å¤‡ä»½ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„é”æ–‡ä»¶ã€‚è¿™ä¸ªé”æ–‡ä»¶åŒ…å«äº†æ“ä½œçš„ç±»å‹ã€å¼€å§‹æ—¶é—´ä»¥åŠæ“ä½œè€…çš„ä¿¡æ¯ã€‚å¦‚æœå­˜åœ¨ä¸€ä¸ªæ´»åŠ¨é”ï¼ŒRestic ä¼šé˜»æ­¢å…¶ä»–å¯èƒ½ä¼šå½±å“æ•°æ®ä¸€è‡´æ€§çš„æ“ä½œæ‰§è¡Œï¼Œç›´åˆ°è¯¥é”è¢«é‡Šæ”¾ã€‚</p><ul><li><strong>ç‹¬å é”ï¼š</strong> ç”¨äºå¤‡ä»½å’Œä¿®å‰ªæ“ä½œï¼Œç¡®ä¿åœ¨è¿™äº›æ“ä½œæ‰§è¡ŒæœŸé—´ï¼Œæ²¡æœ‰å…¶ä»–æ“ä½œå¯ä»¥ä¿®æ”¹ä»“åº“æ•°æ®ã€‚</li><li><strong>å…±äº«é”ï¼š</strong> å…è®¸å¤šä¸ªè¯»å–æ“ä½œåŒæ—¶è¿›è¡Œï¼Œä¾‹å¦‚åˆ—å‡ºå¿«ç…§æˆ–æ£€æŸ¥ä»“åº“ï¼Œä½†é˜»æ­¢å†™å…¥æ“ä½œã€‚</li></ul><p>åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ Restic æ—¶ï¼Œé”å®šæœºåˆ¶æ˜¯è‡ªåŠ¨ç®¡ç†çš„ã€‚ç”¨æˆ·ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºæˆ–é‡Šæ”¾é”ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œè¢«éæ­£å¸¸ç»ˆæ­¢ï¼ˆå¦‚è¿›ç¨‹å´©æºƒæˆ–ç½‘ç»œæ–­å¼€ï¼‰ï¼Œå¯èƒ½ä¼šç•™ä¸‹å­¤ç«‹çš„é”æ–‡ä»¶ã€‚Restic æä¾›äº† <code>unlock</code> å‘½ä»¤æ¥æ¸…ç†è¿™äº›å­¤ç«‹çš„é”ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>restic -r /path/to/repository unlock
</span></span></code></pre></div><h3 id=å®è·µç»“åˆ-restic-ä¸-rclone-è‡ªåŠ¨å¤‡ä»½åŠå¤‡ä»½çŠ¶æ€æ¨é€>å®è·µç»“åˆ Restic ä¸ Rclone è‡ªåŠ¨å¤‡ä»½åŠå¤‡ä»½çŠ¶æ€æ¨é€</h3><h4 id=æ­¥éª¤-1-åˆ›å»ºé…ç½®æ–‡ä»¶>æ­¥éª¤ 1: åˆ›å»ºé…ç½®æ–‡ä»¶</h4><p>åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>backup_config.conf</code>ï¼Œåœ¨å…¶ä¸­å®šä¹‰å¤‡ä»½ä»“åº“ã€å¯†ç æ–‡ä»¶ã€å¤‡ä»½è·¯å¾„ã€æ’é™¤è§„åˆ™æ–‡ä»¶ä»¥åŠæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚ä¾‹å¦‚æ”¾ç½®äº <code>/usr/local/bin/restic_backup</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># backup_config.conf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The repository location for restic backups. This is specified using the rclone backend syntax.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Format: &#34;rclone:&lt;rclone remote name&gt;:&lt;path within the remote&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RESTIC_REPOSITORY=&#34;rclone:OneDrive:backup&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Path to the file containing the password for the restic repository. </span>
</span></span><span style=display:flex><span><span style=color:#75715e># This file should be secured with appropriate permissions to prevent unauthorized access.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>PASSWORD_FILE=&#34;/usr/local/bin/restic_backup/restic_password_file&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># File containing a list of paths to include in the backup. Each path should be on a separate line.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># File containing patterns to exclude from the backup. Each pattern should be on a separate line.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EXCLUDE_FILE=&#34;/usr/local/bin/restic_backup/exclude_rules.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Path to the log file where backup operation details will be recorded.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>LOG_FILE=&#34;/var/log/restic_backup.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># A tag to assign to all snapshots created by this backup for easy identification and management.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>BACKUP_TAG=&#34;automated_backup&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The number of most recent snapshots to keep. Older snapshots exceeding this count will be pruned.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>KEEP_SNAPSHOTS=5 </span> <span style=color:#75715e># Number of snapshots to retain</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Rclone performance optimization settings</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The number of file transfers to run in parallel. Increasing this can improve transfer speeds,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># especially for a large number of small files, assuming the bandwidth allows for it.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The default in rclone is 4 parallel transfers.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RCLONE_TRANSFERS=10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The number of checkers to use. Checkers are used by rclone to determine if a file needs to be transferred.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Increasing this number can speed up this checking process, which can be beneficial when dealing with</span>
</span></span><span style=display:flex><span><span style=color:#75715e># a large number of files. This setting helps in speeding up the comparison between source and destination.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>RCLONE_CHECKERS=20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Telegram notification settings</span>
</span></span><span style=display:flex><span><span style=color:#75715e># TELEGRAM_TOKEN: The API token of your Telegram bot. Leave this empty if you do not wish to send Telegram notifications.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># TELEGRAM_CHAT_ID: The chat ID where notifications will be sent. This can be a personal chat ID or a group chat ID.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Leave these empty to disable Telegram notifications.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TELEGRAM_TOKEN=&#34;1111111223:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TELEGRAM_CHAT_ID=&#34;123433545&#34;</span>
</span></span></code></pre></div><p>åˆ›å»ºå¯†ç æ–‡ä»¶æ³¨æ„è·¯å¾„ä¸ <code>PASSWORD_FILE</code> å‚æ•°å¯¹åº”
å¯é€‚å½“ä¿®æ”¹RCLONE_TRANSFERSå’ŒRCLONE_CHECKERSå‚æ•°å¯æé«˜åœ¨å¤‡ä»½å¤§é‡å°æ–‡ä»¶æ—¶çš„æ€§èƒ½ã€‚
ä»¥åŠæ·»åŠ Telegramæ¶ˆæ¯æ¨é€å¤‡ä»½ç»“æœ</p><h4 id=æ­¥éª¤-2-åˆ›å»ºç›¸å…³æ–‡ä»¶>æ­¥éª¤ 2: åˆ›å»ºç›¸å…³æ–‡ä»¶</h4><p><strong>åˆ›å»ºå¯†ç æ–‡ä»¶:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>echo <span style=color:#e6db74>&#34;your_restic_password&#34;</span> &gt; /usr/local/bin/restic_backup/restic_password_file
</span></span><span style=display:flex><span><span style=color:#75715e># è®¾ç½®æ–‡ä»¶æƒé™</span>
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> /usr/local/bin/restic_backup/restic_password_file
</span></span></code></pre></div><p><strong>åˆ›å»ºå¤‡ä»½è·¯å¾„æ–‡ä»¶:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>/home
</span></span><span style=display:flex><span>/root
</span></span></code></pre></div><p><strong>åˆ›å»ºæ’é™¤è§„åˆ™æ–‡ä»¶:</strong>
åˆ›å»ºä¸€ä¸ªæ’é™¤è§„åˆ™æ–‡ä»¶ <code>exclude_rules.txt</code>ï¼Œåœ¨å…¶ä¸­åˆ—å‡ºæ‰€æœ‰è¦æ’é™¤çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ç±»å‹ã€‚æ³¨æ„è·¯å¾„ä¸ <code>EXCLUDE_FILE</code> æ–‡ä»¶å¯¹åº”ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span># exclude_rules.txt
</span></span><span style=display:flex><span>/home/user/documents/temp
</span></span><span style=display:flex><span>/home/user/photos/drafts
</span></span><span style=display:flex><span>*.tmp
</span></span><span style=display:flex><span>*.cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># æ’é™¤æ‰€æœ‰ä»¥ç‚¹å¼€å¤´çš„éšè—æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
</span></span><span style=display:flex><span>.*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># ä½†ä¿ç•™ç‰¹å®šçš„æ–‡ä»¶ï¼Œå¦‚ .zshrc
</span></span><span style=display:flex><span>!.zshrc
</span></span></code></pre></div><h4 id=æ­¥éª¤-3-ç¼–å†™å¤‡ä»½è„šæœ¬åŠæ¸…ç†è„šæœ¬>æ­¥éª¤ 3: ç¼–å†™å¤‡ä»½è„šæœ¬åŠæ¸…ç†è„šæœ¬</h4><p>ç¼–å†™ä¸€ä¸ªæ–°çš„å¤‡ä»½è„šæœ¬ <code>restic_backup.sh</code>ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå®ç°æ—¥å¿—è®°å½•ä»¥åŠé”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶ï¼Œå¹¶åœ¨è„šæœ¬ç»“æŸæ—¶æä¾›å¤‡ä»½æ‘˜è¦å’Œæ¨é€å¤‡ä»½ç»“æœã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>source /usr/local/bin/restic_backup/backup_config.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check for required commands</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> cmd in restic curl hostname; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! command -v $cmd &amp;&gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Error: Required command &#39;</span>$cmd<span style=color:#e6db74>&#39; not found. Exiting.&#34;</span>
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export RCLONE_TRANSFERS<span style=color:#f92672>=</span>$RCLONE_TRANSFERS
</span></span><span style=display:flex><span>export RCLONE_CHECKERS<span style=color:#f92672>=</span>$RCLONE_CHECKERS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>backup_success<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Function to send Telegram notification</span>
</span></span><span style=display:flex><span>send_telegram<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -z <span style=color:#e6db74>&#34;</span>$TELEGRAM_TOKEN<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> -z <span style=color:#e6db74>&#34;</span>$TELEGRAM_CHAT_ID<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Telegram token or chat ID not set. Skipping notification.&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! curl -s -X POST https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage -d chat_id<span style=color:#f92672>=</span>$TELEGRAM_CHAT_ID -d text<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Warning: Failed to send Telegram notification.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Backup function with retry logic</span>
</span></span><span style=display:flex><span>backup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local retries<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    local delay<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>  <span style=color:#75715e># Initial retry delay in seconds</span>
</span></span><span style=display:flex><span>    local attempt<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> $attempt -le $retries <span style=color:#f92672>]</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        local start_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Starting backup at </span>$start_time<span style=color:#e6db74>, attempt </span><span style=color:#66d9ef>$((</span>attempt+1<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> restic -r <span style=color:#e6db74>&#34;</span>$RESTIC_REPOSITORY<span style=color:#e6db74>&#34;</span> --password-file <span style=color:#e6db74>&#34;</span>$PASSWORD_FILE<span style=color:#e6db74>&#34;</span> backup --files-from <span style=color:#e6db74>&#34;</span>$FILES_FROM<span style=color:#e6db74>&#34;</span> --exclude-file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$EXCLUDE_FILE<span style=color:#e6db74>&#34;</span> --tag <span style=color:#e6db74>&#34;</span>$BACKUP_TAG<span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> 2&gt;&amp;1; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            local end_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;Backup completed successfully at </span>$end_time<span style=color:#e6db74>. Duration: </span><span style=color:#66d9ef>$((</span>end_time <span style=color:#f92672>-</span> start_time<span style=color:#66d9ef>))</span><span style=color:#e6db74> seconds.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            local end_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;Backup failed, attempt </span><span style=color:#66d9ef>$((</span>attempt+1<span style=color:#66d9ef>))</span><span style=color:#e6db74> at </span>$end_time<span style=color:#e6db74>. Check log </span>$LOG_FILE<span style=color:#e6db74> for details.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            attempt<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>attempt <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>            sleep $delay
</span></span><span style=display:flex><span>            delay<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>delay <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span><span style=color:#66d9ef>))</span>  <span style=color:#75715e># Exponential backoff</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Backup failed after </span>$retries<span style=color:#e6db74> retries at </span><span style=color:#66d9ef>$(</span>date +%Y-%m-%d<span style=color:#ae81ff>\ </span>%H:%M:%S<span style=color:#66d9ef>)</span><span style=color:#e6db74>.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    backup_success<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Retrieve hostname and IP address</span>
</span></span><span style=display:flex><span>HOSTNAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>IP_ADDRESS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -s ip.sb<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Function to summarize backup operation and send Telegram notification</span>
</span></span><span style=display:flex><span>backup_summary<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local end_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> $backup_success; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        local stats_output<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>restic -r <span style=color:#e6db74>&#34;</span>$RESTIC_REPOSITORY<span style=color:#e6db74>&#34;</span> --password-file <span style=color:#e6db74>&#34;</span>$PASSWORD_FILE<span style=color:#e6db74>&#34;</span> stats | awk <span style=color:#e6db74>&#39;/Stats in restore-size mode:/,0&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;All backups completed successfully at </span>$end_time<span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        send_telegram <span style=color:#e6db74>&#34;ğŸ‰ Backup completed successfully at </span>$end_time<span style=color:#e6db74> ğŸ‰
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ–¥ï¸ Hostname: </span>$HOSTNAME<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸŒ IP Address: </span>$IP_ADDRESS<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ’¾ Repository: </span>$RESTIC_REPOSITORY<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ¤– Repository Stats: 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>$stats_output<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;One or more backups failed at </span>$end_time<span style=color:#e6db74>, see log </span>$LOG_FILE<span style=color:#e6db74> for details.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        send_telegram <span style=color:#e6db74>&#34;âŒ Backup failed at </span>$end_time<span style=color:#e6db74> âŒ
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ–¥ï¸ Hostname: </span>$HOSTNAME<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸŒ IP Address: </span>$IP_ADDRESS<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ’¾ Repository: </span>$RESTIC_REPOSITORY<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Check log </span>$LOG_FILE<span style=color:#e6db74> for details.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Starting backup process at </span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>backup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! $backup_success; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Performing detailed check due to previous failures...&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    restic -r <span style=color:#e6db74>&#34;</span>$RESTIC_REPOSITORY<span style=color:#e6db74>&#34;</span> --password-file <span style=color:#e6db74>&#34;</span>$PASSWORD_FILE<span style=color:#e6db74>&#34;</span> check &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    send_telegram <span style=color:#e6db74>&#34;Restic repository check performed due to backup failure. Check log </span>$LOG_FILE<span style=color:#e6db74> for details.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Skipping detailed check as all backups were successful.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>backup_summary
</span></span></code></pre></div><p>èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼š<code>chmod +x /path/to/restic_backup.sh</code>ã€‚</p><p>ç¼–å†™æ¸…ç†å¿«ç…§è„šæœ¬,å…·ä½“è¦ä¿ç•™çš„å¿«ç…§æ•°é‡å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªè¡Œä¿®æ”¹ï¼Œæ³¨æ„å…·æœ‰ä¸åŒçš„è·¯å¾„æˆ–æ ‡ç­¾ï¼Œå®ƒä»¬è¢«è§†ä¸ºä¸åŒçš„å¤‡ä»½é›†åˆï¼Œä¼šå•ç‹¬è®¡ç®—ä¿å­˜çš„å¿«ç…§æ•°é‡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>source /usr/local/bin/restic_backup/backup_config.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HOSTNAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>IP_ADDRESS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -s ip.sb<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>send_telegram<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local message<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -z <span style=color:#e6db74>&#34;</span>$TELEGRAM_TOKEN<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> -z <span style=color:#e6db74>&#34;</span>$TELEGRAM_CHAT_ID<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Telegram token or chat ID not set. Skipping notification.&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ! curl -s -X POST https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage -d chat_id<span style=color:#f92672>=</span>$TELEGRAM_CHAT_ID -d text<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$message<span style=color:#e6db74>&#34;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Warning: Failed to send Telegram notification.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleanup_snapshots<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Starting cleanup process at </span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> restic -r <span style=color:#e6db74>&#34;</span>$RESTIC_REPOSITORY<span style=color:#e6db74>&#34;</span> --password-file <span style=color:#e6db74>&#34;</span>$PASSWORD_FILE<span style=color:#e6db74>&#34;</span> forget --keep-last <span style=color:#e6db74>&#34;</span>$KEEP_SNAPSHOTS<span style=color:#e6db74>&#34;</span> --prune 2&gt;&gt;<span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        local stats_output<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>restic -r <span style=color:#e6db74>&#34;</span>$RESTIC_REPOSITORY<span style=color:#e6db74>&#34;</span> --password-file <span style=color:#e6db74>&#34;</span>$PASSWORD_FILE<span style=color:#e6db74>&#34;</span> stats | awk <span style=color:#e6db74>&#39;/Stats in restore-size mode:/,0&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Cleanup completed successfully at </span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>. Kept the last </span>$KEEP_SNAPSHOTS<span style=color:#e6db74> snapshots.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        send_telegram <span style=color:#e6db74>&#34;ğŸ§¹ Cleanup completed successfully at </span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ–¥ï¸ Hostname: </span>$HOSTNAME<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸŒ IP Address: </span>$IP_ADDRESS<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ’¾ Repository: </span>$RESTIC_REPOSITORY<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Kept the last </span>$KEEP_SNAPSHOTS<span style=color:#e6db74> snapshots.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ¤– Repository Stats: 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>$stats_output<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Cleanup failed at </span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>, see log for details.&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        send_telegram <span style=color:#e6db74>&#34;âŒ Cleanup failed at </span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ–¥ï¸ Hostname: </span>$HOSTNAME<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸŒ IP Address: </span>$IP_ADDRESS<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ğŸ’¾ Repository: </span>$RESTIC_REPOSITORY<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Check log </span>$LOG_FILE<span style=color:#e6db74> for details.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleanup_snapshots
</span></span></code></pre></div><p>èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼š<code>chmod +x /path/to/restic_cleanup.sh</code>ã€‚</p><h4 id=æ­¥éª¤-4-é…ç½®å®šæ—¶ä»»åŠ¡>æ­¥éª¤ 4: é…ç½®å®šæ—¶ä»»åŠ¡</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>crontab -e
</span></span></code></pre></div><p>åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œæ·»åŠ ä¸€è¡Œä»¥å®šä¹‰æ–°çš„è®¡åˆ’ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ—¶é—´è®¾ç½®ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ¯ä¸ªæœˆçš„ç¬¬äºŒå¤©çš„å‡Œæ™¨ 2 ç‚¹ 1 åˆ†æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span> * * /bin/bash /path/to/your_backup_script.sh &gt;&gt; /path/to/backup_cron.log 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¯3ä¸ªæœˆæ‰§è¡Œä¸€æ¬¡æ¸…ç†</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span> */3 * /bin/bash /path/to/restic_cleanup.sh &gt;&gt; /path/to/cleanup_cron.log 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>è¿è¡Œ <code>crontab -l</code> æ¥åˆ—å‡ºæ‰€æœ‰å·²ç»å®‰æ’çš„ <code>cron</code> ä½œä¸šï¼Œç¡®ä¿çš„å¤‡ä»½ä»»åŠ¡å·²ç»è¢«æ­£ç¡®æ·»åŠ ã€‚</p></div></div><div class=article-paging><section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box"><div class=card-cover background-image-lazy data-img=https://cdn.jsdelivr.net/gh/2cracer2/oss@master/uPic/port-knock.jpg></div><div class=card-text><a href=/posts/202403010045/><h4 class="card-text--title text-ellipsis">Port Knocking ç«¯å£æ•²é—¨âœŠ</h4></a><p class=card-text--row>2024-03-01 00:45</p></div></section></div></div><aside class=widget-info><section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box"><div class=widget-body><div class="author-box avatar"><img class="author-avatar soft-size--round soft-style--box" src=https://cdn.jsdelivr.net/gh/2cracer2/oss@master/uPic/iol.svg alt=Ecrose><h2 class="author-name text-ellipsis">Ecrose</h2><p class="author-desc text-ellipsis">å°½å¿ƒå°½åŠ›ï¼Œè‡ªæœ‰ä¸‡é‡Œé•¿é£ã€‚</p></div></div></section><section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box"><h2 class=widget-header><div class=title><span>Related Posts</span></div></h2><div class=widget-body><ul class=post-list><li class=post-item><a href=/posts/202403010045/>Port Knocking ç«¯å£æ•²é—¨âœŠ</a></li><li class=post-item><a href=/posts/202312102332/>DALLE æ•™ç¨‹</a></li><li class=post-item><a href=/posts/202311062332/>mac-mini æŠ˜è…¾</a></li><li class=post-item><a href=/posts/202304202032/>æ•°æ®å¤‡ä»½æ–¹æ¡ˆ</a></li><li class=post-item><a href=/posts/202205120045/>å‘½ä»¤è¡Œçš„è‰ºæœ¯</a></li></ul></div></section><section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box"><h2 class=widget-header><div class=title><span>Categories</span></div></h2><div class=widget-body><ul class=categories-list><li><a href=/categories/%E6%9D%82%E6%8A%80%E6%B5%85%E5%B0%9D/>æ‚æŠ€æµ…å°</a>
<span>8</span></li><li><a href=/categories/%E6%8A%80%E6%9C%AF/>æŠ€æœ¯</a>
<span>2</span></li><li><a href=/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/>æ•°æ®åº“</a>
<span>1</span></li><li><a href=/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/>æ‚ä¸ƒæ‚å…«</a>
<span>1</span></li></ul></div></section><section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box"><h2 class=widget-header><div class=title><span>Tags</span></div></h2><div class=widget-body><div class=tags-list><a href=/tags/%E8%B5%84%E6%BA%90/ data-count=3 class="soft-size--small soft-style--hover soft-style--active">èµ„æº</a>
<a href=/tags/database/ data-count=2 class="soft-size--small soft-style--hover soft-style--active">Database</a>
<a href=/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/ data-count=2 class="soft-size--small soft-style--hover soft-style--active">å·¥å…·ä½¿ç”¨</a>
<a href=/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/ data-count=2 class="soft-size--small soft-style--hover soft-style--active">æ•°æ®å¤‡ä»½</a>
<a href=/tags/%E5%AE%89%E5%85%A8/ data-count=1 class="soft-size--small soft-style--hover soft-style--active">å®‰å…¨</a>
<a href=/tags/%E6%97%A5%E5%B8%B8/ data-count=1 class="soft-size--small soft-style--hover soft-style--active">æ—¥å¸¸</a>
<a href=/tags/%E9%9A%90%E5%86%99%E6%9C%AF/ data-count=1 class="soft-size--small soft-style--hover soft-style--active">éšå†™æœ¯</a></div></div></section></aside></div></main><footer class="footer-container layout-block"><div class=social-icons><a class="soft-size--primary soft-style--box" href=https://github.com/2cracer2 target=_blank rel="noopener noreferrer"><svg class="icon icon-github" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3.0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4.0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4.0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"/></svg>
</a><a class="soft-size--primary soft-style--box" href=https://twitter.com/ target=_blank rel="noopener noreferrer"><svg class="icon icon-twitter" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M962.285714 233.142857q-38.285714 56-92.571429 95.428571.571429 8 .571429 24 0 74.285714-21.714286 148.285714t-66 142-105.428571 120.285714-147.428571 83.428571-184.571429 31.142857q-154.857143.0-283.428571-82.857143 20 2.285714 44.571429 2.285714 128.571429.0 229.142857-78.857143-60-1.142857-107.428571-36.857143t-65.142857-91.142857q18.857143 2.857143 34.857143 2.857143 24.571429.0 48.571429-6.285714-64-13.142857-106-63.714286t-42-117.428571v-2.285714q38.857143 21.714286 83.428571 23.428571-37.714286-25.142857-60-65.714286t-22.285714-88q0-50.285714 25.142857-93.142857 69.142857 85.142857 168.285714 136.285714t212.285714 56.857143q-4.571429-21.714286-4.571429-42.285714.0-76.571429 54-130.571429t130.571429-54q80 0 134.857143 58.285714 62.285714-12 117.142857-44.571429-21.142857 65.714286-81.142857 101.714286 53.142857-5.714286 106.285714-28.571429z"/></svg>
</a><a class="soft-size--primary soft-style--box" href=https://www.instagram.com/ target=_blank rel="noopener noreferrer"><svg class="icon icon-instagram" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M512 0C372.906667.0 355.541333.64 300.928 3.072 246.4 5.632 209.28 14.208 176.64 26.88c-33.664 13.056-62.250667 30.592-90.709333 59.050667S39.893333 142.933333 26.88 176.64C14.208 209.28 5.589333 246.4 3.072 300.928.512 355.541333.0 372.906667.0 512s.64 156.458667 3.072 211.072c2.56 54.485333 11.136 91.648 23.808 124.288a251.093333 251.093333.0 0059.050667 90.709333A250.368 250.368.0 00176.64 997.12c32.682667 12.629333 69.802667 21.290667 124.288 23.808C355.541333 1023.488 372.906667 1024 512 1024s156.458667-.64 211.072-3.072c54.485333-2.56 91.648-11.178667 124.288-23.808a251.648 251.648.0 0090.709333-59.050667A250.026667 250.026667.0 00997.12 847.36c12.629333-32.64 21.290667-69.802667 23.808-124.288 2.56-54.613333 3.072-71.978667 3.072-211.072s-.64-156.458667-3.072-211.072c-2.56-54.485333-11.178667-91.690667-23.808-124.288a251.306667 251.306667.0 00-59.050667-90.709333A249.472 249.472.0 00847.36 26.88C814.72 14.208 777.557333 5.589333 723.072 3.072 668.458667.512 651.093333.0 512 0zm0 92.16c136.661333.0 152.96.682667 206.933333 3.029333 49.92 2.346667 77.013333 10.624 95.018667 17.706667 23.978667 9.258667 40.96 20.352 58.965333 38.229333 17.877333 17.92 28.970667 34.944 38.229334 58.922667 6.997333 18.005333 15.36 45.098667 17.621333 95.018667C931.2 359.082667 931.754667 375.296 931.754667 512s-.64 152.96-3.157334 206.933333c-2.602667 49.92-10.922667 77.013333-17.962666 95.018667a162.56 162.56.0 01-38.357334 58.965333 159.744 159.744.0 01-58.88 38.229334c-17.92 6.997333-45.44 15.36-95.36 17.621333C663.68 931.2 647.68 931.754667 510.72 931.754667c-137.002667.0-153.002667-.64-207.317333-3.157334C253.44 925.994666 225.92 917.674666 208 910.634667a158.549333 158.549333.0 01-58.837333-38.357334 155.477333 155.477333.0 01-38.4-58.88c-7.04-17.92-15.317333-45.44-17.92-95.36-1.92-53.76-2.602667-70.357333-2.602667-206.677333.0-136.362667.682667-153.002667 2.602667-207.402667 2.602667-49.92 10.88-77.397333 17.92-95.317333 8.96-24.32 20.437333-40.96 38.4-58.922667C167.04 131.84 183.722667 120.32 208 111.402667 225.92 104.32 252.842667 96 302.762667 93.44c54.4-1.92 70.4-2.56 207.317333-2.56l1.92 1.28zm0 156.928a262.912 262.912.0 100 525.824 262.912 262.912.0 100-525.824zm0 433.578667c-94.293333.0-170.666667-76.373333-170.666667-170.666667S417.706666 341.333333 512 341.333333 682.666667 417.706666 682.666667 512 606.293334 682.666667 512 682.666667zM846.762667 238.72a61.482667 61.482667.0 01-122.88.0 61.44 61.44.0 01122.88.0z"/></svg>
</a><a class="soft-size--primary soft-style--box" href=https://weibo.com/ target=_blank rel="noopener noreferrer"><svg class="icon icon-weibo" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg"><path d="M385.682429 733.696q11.995429-19.456 6.290286-39.424t-25.746286-28.598857q-19.456-7.972571-41.691429-.585143t-34.304 26.258286q-12.580571 19.456-7.460571 39.131429t24.576 28.891429 42.569143 1.462857 35.693714-27.136zm53.76-69.12q4.534857-7.460571 1.974857-15.140571t-10.020571-10.605714q-7.972571-2.852571-16.310857.292571t-12.288 10.605714q-9.728 17.700571 7.460571 25.746286 7.972571 2.852571 16.603429-.292571t12.580571-10.605714zm99.401143 61.147429q-25.746286 58.294857-90.258286 85.723429t-128 6.875429q-61.147429-19.456-84.260571-72.265143t3.730286-107.154286q26.843429-53.174857 86.601143-79.433143t120.32-10.825143q63.414857 16.603429 90.550857 68.315429t1.462857 108.836571zm178.322286-91.428572q-5.12-54.857143-50.834286-97.133714t-119.149714-62.317714T390.290429 462.848Q262.875572 476.013714 179.127 543.670857T103.424143 694.784q5.12 54.857143 50.834286 97.133714t119.149714 62.317714 156.891429 11.995429Q557.714429 853.065143 641.463001 785.408t75.702857-151.113143zM893.147572 636.562286q0 38.838857-21.138286 79.725714t-62.317714 78.262857-96.256 67.145143-129.170286 47.396571-154.550857 17.700571-157.110857-19.163429-137.435429-53.174857-98.011429-86.308571-37.156571-114.029714q0-65.682286 39.716571-139.995429t112.859429-147.456q96.548571-96.548571 195.145143-134.875429t140.873143 4.022857q37.156571 36.571429 11.410286 119.442286-2.267429 7.972571-.585143 11.410286t5.705143 4.022857 8.265143-.292571 7.68-1.974857l3.437714-1.170286q79.433143-33.718857 140.580571-33.718857t87.405714 34.889143q25.746286 35.986286.0 101.741714-1.170286 7.460571-2.56 11.410286t2.56 7.168 6.875429 4.315429 9.728 3.437714q32.548571 10.313143 58.88 26.843429t45.714286 46.592 19.456 66.56zM850.871001 279.990857q23.990857 26.843429 31.158857 62.025143t-3.730286 67.145143q-4.534857 13.165714-16.822857 19.456t-25.453714 2.267429q-13.165714-4.534857-19.456-16.822857t-2.267429-25.453714q11.410286-35.986286-13.677714-63.414857t-61.147429-19.968q-13.677714 2.852571-25.746286-4.534857t-14.262857-21.138286q-2.852571-13.677714 4.534857-25.453714t21.138286-14.555429q34.304-7.460571 68.022857 3.145143T850.871 280.137144zM954.295001 186.88q49.737143 54.857143 64.292571 127.122286t-7.68 138.020571q-5.12 15.433143-19.456 22.820571t-29.696 2.267429-22.820571-19.456-2.852571-29.696q16.018286-46.884571 5.705143-98.304t-45.714286-90.258286q-35.401143-39.424-84.553143-54.564571t-98.889143-4.827429q-16.018286 3.437714-29.696-5.412571t-17.115429-24.868571T671.232143 120.32t24.868571-16.822857Q766.391 88.649143 835.511 110.08t118.857143 76.873143z"/></svg>
</a><a class="soft-size--primary soft-style--box" href=https://www.zhihu.com/ target=_blank rel="noopener noreferrer"><svg class="icon icon-zhihu" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M544.949 561.422s0-71.387-34.779-75.05-142.775.0-142.775.0V266.718h161.078s-1.83-73.219-32.949-73.219H233.769l43.93-117.148s-65.897 3.663-89.692 45.761-98.844 252.604-98.844 252.604 25.627 10.983 67.726-20.134c42.101-31.116 56.743-86.033 56.743-86.033l76.879-3.663 1.83 223.316s-133.621-1.83-161.078.0-42.101 75.05-42.101 75.05h203.182s-18.307 124.47-69.557 214.164c-53.085 89.692-151.929 161.078-151.929 161.078s71.387 29.287 140.947-10.983c69.557-42.101 120.811-223.316 120.811-223.316l162.912 203.182s14.643-97.013-1.83-124.47c-18.307-27.457-113.49-137.283-113.49-137.283l-42.101 36.607 29.287-120.811h177.552zM587.05 188.01l-1.83 660.793h65.897l23.795 82.37 115.321-82.37h162.912V188.01H587.054zM879.92 775.584h-76.879l-97.013 75.05-21.965-75.05h-20.134V263.057H879.92v512.527z"/></svg></a></div><div class=colour-bar></div><p>Â© 2022 <a href=https://github.com/2cracer2>Ecrose</a>.</p><p>Powered by
<a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a>
Theme -
<a href=https://github.com/miiiku/hugo-theme-kagome target=_blank rel="noopener noreferrer author">kagome</a></p><p><a href=javascript:; id=theme-light>ğŸŒ light</a>
<a href=javascript:; id=theme-dark>ğŸŒ› dark</a>
<a href=javascript:; id=theme-auto>ğŸ¤–ï¸ auto</a></p></footer></body></html>